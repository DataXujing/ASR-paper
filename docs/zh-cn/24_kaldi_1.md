## Kaldi v1

<!-- 语音识别常用的工具：https://mp.weixin.qq.com/s/ZFD2mUAC1B6ZH5JEf5yJmg -->
<!-- https://edu.speechhome.com/p/t_pc/course_pc_detail/video/v_628738dce4b09dda126afe52?product_id=course_29PxU67tXQ4UUKanZ65QK2ovY2d -->

<!-- https://edu.speechhome.com/p/t_pc/course_pc_detail/camp_pro/course_29PxU67tXQ4UUKanZ65QK2ovY2d -->

<!-- https://github.com/du-ud/kaldi-cslt -->

关于Kaldi的学习，我推荐大家阅读以下3本书和语音之家的公开课，笔者关于Kaldi的学习也来源于此：

| 《语音识别基本法 Kaldi实践与探索》 | 《Kaldi语音识别实战》 | 《语音识别原理与应用》 |
| ---------------------------------- | --------------------- | ---------------------- |
|  <img src="zh-cn/img/ch28/p1.png"   /> |  <img src="zh-cn/img/ch28/p2.png"   />|  <img src="zh-cn/img/ch28/p3.png"   /> |


也可也学习语音之家开源的公开课：

+ [Kaldi语音识别理论与实践](https://edu.speechhome.com/p/t_pc/course_pc_detail/camp_pro/course_29PxU67tXQ4UUKanZ65QK2ovY2d)

为了深入研究Kaldi我们在这里继续进行传统语音识别技术的介绍，包括**语音编码**,**语音特征提取**,**再谈GMM-HMM**,**再谈DNN-HMM**,**音素的上下文建模**,**静音检测**,**i-vector,x-vector**

### 1.语音编码

<!-- 本周4完成 -->

声波通过空气传播，被麦克风接收，再被转换为模拟的语音信号，如下图所示。这些信号经过采样，变成离散的时间信号，再进一步经过量化，被保存为数字信号，即波形文件

<div align=center>
    <img src="zh-cn/img/ch28/p4.jpg"   /> 
</div>

我们将在本节介绍声波的特性，声音的采集装置（麦克风），声音的采样和量化，最后介绍语音文件的格式和分析。


#### 1.1 声波的特性

声波在空气中是一种纵波，他的震动方向和传播方向是一致的。声音在空气中的振动形成压力波动，产生压强，再经过传感器接收转换，变成时变的电压信号。

声波的特性主要包括频率和声强。频率是指在单位时间内声波的周期数，而直接测量声强较为困难，故常用声压来衡量声音的强弱。某一瞬间介质中的压强相对于无声波时的改变量称为声压，记为$p(t)$,单位是$Pa$

由于人耳感知的声压动态范围太大，加之人耳对声音大小的感觉近似的与声压，声强呈对数关系，所以通常用对数值来度量声音。一般把很小的声压$p_0=2\times 10^{-5}Pa$作为参考声压，把所要测量的声压$p$与参考声压$p_0$的比值取常用对数后，乘以20得到的数称为声压级（SPL),其单位是分贝(dB)

$$SPL=20log(\frac{p}{p_0}) dB$$

国家标准规定，住宅区的噪音大小为白天不能超过50dB,夜间应低于45dB。注意，衡量声音的信噪比（SNR)的单位也用分贝，其数值越高，表示声音越干净，噪声比例越小。

#### 1.2 声音的接收装置

麦克风包括动圈式和电容式2种，其中动圈式麦克风精度，灵敏度较低，体积大，其突出特点是输出阻抗小，所以接较长的电缆也不降低其灵敏度，且温度和湿度的变化对其灵敏度没有大影响，适用于广播，扩声系统。电容式的麦克风音质好，灵敏度高，但常需要电源，适用于舞台，录音室内等。

驻极体麦克风是电容式的一种，无需外加电源，其体积小，使用较广泛。驻极体麦克风包含以下两种类型。

+ 振膜式：带电体是驻极体振膜本身，话筒拾声的音质效果相对较差，多用于在对于音质效果要求不高的场合，如普通的电话机，玩具等
+ 背级式：带电体是涂敷在背极板上的驻极体膜层，与振膜分离设计，手机， 语音识别等高端传声录音产品多采用背极式驻极体。

随着现代生产工艺的发展，现代工业上广泛采用MEMS麦克风。MEMS麦克风从原理上依然属于电容式麦克风，其中一个电容器集成在微硅晶片上，可以采用表贴工艺进行制造。MEMS麦克风的优点是一致性比较好，特别适用于在中高端手机应用中，也适用于进行远场语音交互的麦克风阵列。

麦克风主要包括以下性能指标：

+ 指向性

麦克风对于不同方向的声音灵敏度，称为麦克风的指向性，指向性用于麦克风正面0度方向和背面180度方向上的灵敏度的差值来表示，差值大于15dB称为强方向性麦克风。全指向性麦克风从各个方向拾取声音的性能一致。当说话的人要来回走动时采用此类麦克风较为合适，但是在环境噪声大的条件下不宜采用。心形指向麦克风的灵敏度在水平方向呈心脏形，正面灵敏度最大，侧面稍小，背面最小。这种麦克风在多种扩音系统中都有优秀的表现。单指向性麦克风又称为超心形指向性麦克风，他的指向性比心形麦克风更尖锐，正面灵敏度极高，其他方向的灵敏度急剧衰减，特别适用于高噪音的环境。

+ 频率响应

表示麦克风拾音的频率范围，以及在此范围内对声音各频率的灵敏度。一般来说，频率范围越宽，频率曲线越平直越好。

+ 灵敏度

在单位声压激励下，输出电压与输入电压的比值，单位为$mV/Pa$。实际衡量采用相对值，以分贝表示，并规定$1V/Pa$为0dB。因话筒输出一般是毫伏级，所以其灵敏度的分贝值始终为负值。

+ 输出阻抗

目前常见的麦克风为高阻抗或低阻抗之分，高阻抗一般在$2k\Omega\~3l\Omega$以上，低阻抗一般在$1k\Omega$以下。高阻抗麦克风灵敏度高；低阻抗的麦克风适合长距离采集传输，连接线即使拉的长一些，也不会改变其特性，音质几乎没有变化，也很少受外界信号干扰。

**麦克风阵列**

对于远距离识别(也成远场识别)，用一个麦克风采集语音是不够的，无法判断方位和语音增强，需要采用麦克风阵列。麦克风阵列采用两个或多个以上的麦克风，如亚马逊的Echo音响采用了6+1麦克风阵列

<div align=center>
    <img src="zh-cn/img/ch28/p5.png"   /> 
</div>

麦克风阵列有线形，圆形等多种排列方式，主要实现以下功能：
+ 语音增强
+ 声源定位
+ 去混响
+ 声源信号提取(分离)

麦克风阵列最后将两个或多个麦克风的信号耦合到一个信号，即在多个麦克风的正前方形成一个接收区域，来削减麦克风侧向的收音效果，最大限度的将环境背景声音过滤掉，抑制噪声，并增强正前方传来的声音，从而保留语音信号。

#### 1.3 声音的采样

声音的采样过程是把模拟信号转换为离散信号。采样的标准是能够重现声音，与原始语音尽量保持一致。采样率表示每秒采样的点数，单位是赫兹，如下图：

<div align=center>
    <img src="zh-cn/img/ch28/p6.png"   /> 
</div>

声音的采样需要满足采样定理：当采样率大于信号最高频率的两倍时，采样数字信号能够完整保留原始信号中的信息。该采样定理又被称为奈奎斯特定理。如果采样率($F_{samp}$)低于限号最高频率的2倍($2f_{max}$),则采样信号会产生折叠失真：

<div align=center>
    <img src="zh-cn/img/ch28/p7.png"   /> 
</div>

人耳能听到的频率是20Hz-20kHz,发声的基音频率在70Hz-450Hz,而经过口腔鼻腔产生的谐波（周期性信号）频率一般在4khz以内，但也有部分在4kHz-8kHz。

一般来说，电话与嵌入式设备的存储空间或带宽有限，采样率较低，为8kHz;手机与PC机的采样率为16kHz,是现在的主流采样率；而CD的采样率则达到无损的程度，为44.1kHz。采样率越高，采集的间隔就越短，对应的音频损失就越小。

#### 1.4 声音的量化

声音被采样后，模拟的电压信号变成离散的采样值。声音的量化过程是指将每个采样值在幅度上再进行离散化处理，变成整形数值。如下表所示，电压范围在0.5-0.7V的采样点被量化为十进制数3，用两位2进制数编码11,...,总共4个量化值，只用两位的二进制数表示，取值范围为$0\~2^2-1$

<div align=center>
    <img src="zh-cn/img/ch28/p8.png"   /> 
</div>

下图，右边是量化后的波形，可以看出和左边原始波形差异很大。量化位数代表每次取样的信息量，量化会引入失真，并且这种失真不可逆，量化的位数可以是4位，8位，16位，32位，量化位数越高，失真越少，但占用的存储空间越多，一般采用16位量化。

<div align=center>
    <img src="zh-cn/img/ch28/p9.png"   /> 
</div>

量化方法分为均匀量化和非均匀量化，其中均匀量化采用相等的量化间隔，而非均匀量化针对大的输入信号采用大的量化间隔，小的输入信号采用小的量化间隔。这样可以在精度损失不大的情况下用较小的位数来表示信号，以减少存储空间。

<div align=center>
    <img src="zh-cn/img/ch28/p10.png"   /> 
</div>

将声音的采样率和量化位数相乘得到比特率（bps），其代表了每个音频样本每秒量化的比特位数。比如一段音频的采样率是16kHz,量化位数是16位，那么该音频的比特率是`16x16=256bps/s`。

#### 1.5 语音的编码

语音编码最早用于通信领域，1975年1月美国实现了使用LPC声码器的分组语音电话会议；1988年美国公布了一个4.8kb/s的码激励线性预测编码(CELP)语音编码标准算法；进入20世纪90年代后，随着互联网的兴起和语音编码技术的发展，IP分组语音通信技术或得了突破性的进展，如在网络游戏中，语音聊天采用IP电话技术。20世纪90年代中期还出现了很多被广泛使用的语音编码国际标准，如数码率为5.3/6.4kb/s的G.723.1等。

在语音存储过程中也需要编码，常用的音频编码格式包括PCM,MP3,A-law等

+ PCM编码：PCM(Pulse Code Modulation 脉冲编码调制)是对模拟信号进行采样，量化，编码的过程。他只保存编码后的数据，并不保存任何格式信息。PCM编码的最大优点是音质好，最大缺点是占用存储空间多。

PCM编码是PC麦克风常用的编码格式（宽带录音，16kHz,16bits)。可保存为PCM raw data(.raw文件，无头部)或Microsoft PCM格式（.wav文件）

还有一种编码格式是自使用差分PCM(ADPCM),其利用样本和样本之间高度相关性，通过已知数据预测下一个数据，然后计算出预测值和实际值之间的差值，再根据不同差值调整比例因子，进行自适应编码，达到较高的压缩比。ADPCM编码被保存为Microsoft ADPCM格式（.wav文件）

+ MP3编码

MP3编码对音频信号采用的是有损压缩格式，压缩比高达10:1~12:1。MP3编码模拟人耳听觉机制，采取“感知编码技术”，使压缩后的文件回放时能达到比较接近原始音频数据的声音效果。

+ A律编码

A律编码是ITU-T（国际电信联盟电信标准局）定义的关于脉冲编码的一种压缩/解压缩算法。是固话录音常用的格式（窄带录音8kHz,8bits)。欧洲和中国大陆等地区采用A律压缩算法，北美和日本则采用$\mu$律算法进行脉冲编码。

其他的常见编码还包括：

+ AMR(Adaptive Multi-Rate):每秒钟的AMR音频大小可以控制在1KB左右，常用于彩信，微信语音，但是失真比较厉害
+ WMA(Windows Media Audio):为抗衡MP3，微软推出了一种新的音频格式，在压缩比和音质上超过了MP3
+ AAC(Advanced Audio Coding): 相比于MP3,ACC格式的音质更佳，文件更小
+ M4A：MPEG-4音频标准的文件扩展名，最常用的.m4a文件使用AAC格式
+ FLAC(Free Lossless Audio Codec,自由音频压缩编码)：2012年以来被很多软硬件支持，其特点是无损压缩，不会破坏任何音频信息
+ Speex:Speex是一种音频编解码的库，他的比特率和压缩率的变化范围较广，常用于网络状况复杂多变的移动终端应用。

基于PCM变得WAV格式常作为不同编码互相转化的一种介质格式，以便于后续处理

<div align=center>
    <img src="zh-cn/img/ch28/p11.png"   /> 
</div>

比如我们把A律格式（8kHz,8bits)的音频文件转换为PCM WAV格式（8kHz,16bits)。要实现更多音频格式的转换，可使用FFmpeg工具。FFmpeg是一个强大的处理音视频的开源库，可实现不同批量数据的快速转换，包括转成指定采样率的WAV格式。

最后介绍两个音频处理的工具：

+ CoolEdit:可以方便的对音频文件进行剪辑和转换，如删除中间部分音频或将采样率从16kHz降到8kHz
+ Praat: 其在语音标注领域应用非常广泛，可用来同时显示原始语音的时域图和语谱图，并进行局部分析
+ Audacity:一款好用的音频编辑工具


### 2.语音特征提取

<!-- 本周4完成 -->


### 3.再谈GMM-HMM

<!-- 周5 -->


### 4.再谈DNN-HMM
<!-- 周5 -->



### 5.音素的上下文建模
<!-- 周5 -->



### 6.静音检测

<!-- 周6 -->

### 7.i-vector, x-vector
<!-- 周6 -->
